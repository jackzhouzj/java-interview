# Javaç½‘ç»œç¼–ç¨‹ å®Œæ•´æ•™ç¨‹

## ğŸ“‹ ç›®å½•
- [æŠ€æœ¯æ¦‚è¿°](#æŠ€æœ¯æ¦‚è¿°)
- [å­¦ä¹ ç›®æ ‡](#å­¦ä¹ ç›®æ ‡)
- [ç½‘ç»œåŸºç¡€](#ç½‘ç»œåŸºç¡€)
- [TCPç¼–ç¨‹](#tcpç¼–ç¨‹)
- [UDPç¼–ç¨‹](#udpç¼–ç¨‹)
- [HTTPç¼–ç¨‹](#httpç¼–ç¨‹)
- [NIOç¼–ç¨‹](#nioç¼–ç¨‹)
- [å®æˆ˜åº”ç”¨](#å®æˆ˜åº”ç”¨)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [ç›¸å…³èµ„æº](#ç›¸å…³èµ„æº)
- [å­¦ä¹ æ£€æŸ¥æ¸…å•](#å­¦ä¹ æ£€æŸ¥æ¸…å•)

## ğŸ“š æŠ€æœ¯æ¦‚è¿°
- **ç‰ˆæœ¬**: Java 8+
- **å®˜æ–¹æ–‡æ¡£**: https://docs.oracle.com/javase/tutorial/networking/
- **å­¦ä¹ éš¾åº¦**: â­â­â­â­ (4æ˜Ÿ)
- **é‡è¦ç¨‹åº¦**: â­â­â­â­â­ (5æ˜Ÿ)
- **å‰ç½®çŸ¥è¯†**: JavaåŸºç¡€ã€å¤šçº¿ç¨‹
- **æ–‡æ¡£æ¥æº**: Oracleå®˜æ–¹æ–‡æ¡£ + ã€ŠJavaç½‘ç»œç¼–ç¨‹ã€‹
- **æ›´æ–°æ—¶é—´**: 2024-01-04
- **ä½œè€…**: @author erik.zhou

## ğŸ¯ å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£TCP/IPåè®®æ ˆ
- [ ] æŒæ¡Socketç¼–ç¨‹
- [ ] ç†è§£TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹
- [ ] æŒæ¡HTTPåè®®å’Œç¼–ç¨‹
- [ ] ç†è§£NIOå’Œå¤šè·¯å¤ç”¨
- [ ] èƒ½å¤Ÿå¤„ç†ç½‘ç»œç¼–ç¨‹ä¸­çš„å¸¸è§é—®é¢˜

## ğŸ“– ç½‘ç»œåŸºç¡€

### 1.1 OSIä¸ƒå±‚æ¨¡å‹å’ŒTCP/IPå››å±‚æ¨¡å‹ ğŸ”¥

```
OSIä¸ƒå±‚æ¨¡å‹          TCP/IPå››å±‚æ¨¡å‹
åº”ç”¨å±‚               åº”ç”¨å±‚
è¡¨ç¤ºå±‚               (HTTPã€FTPã€DNS)
ä¼šè¯å±‚               
ä¼ è¾“å±‚               ä¼ è¾“å±‚
                    (TCPã€UDP)
ç½‘ç»œå±‚               ç½‘ç»œå±‚
                    (IPã€ICMP)
æ•°æ®é“¾è·¯å±‚           ç½‘ç»œæ¥å£å±‚
ç‰©ç†å±‚               (ä»¥å¤ªç½‘ã€WiFi)
```

### 1.2 TCP vs UDP

| ç‰¹æ€§ | TCP | UDP |
|------|-----|-----|
| è¿æ¥ | é¢å‘è¿æ¥ | æ— è¿æ¥ |
| å¯é æ€§ | å¯é ä¼ è¾“ | ä¸å¯é ä¼ è¾“ |
| é€Ÿåº¦ | è¾ƒæ…¢ | è¾ƒå¿« |
| åº”ç”¨åœºæ™¯ | æ–‡ä»¶ä¼ è¾“ã€HTTP | è§†é¢‘ç›´æ’­ã€DNS |

### 1.3 TCPä¸‰æ¬¡æ¡æ‰‹ï¼ˆâš ï¸ éš¾ç‚¹ï¼‰

```
å®¢æˆ·ç«¯                    æœåŠ¡å™¨
  |                         |
  |----SYN(seq=x)---------->|  ç¬¬ä¸€æ¬¡æ¡æ‰‹
  |                         |
  |<---SYN+ACK(seq=y,ack=x+1)|  ç¬¬äºŒæ¬¡æ¡æ‰‹
  |                         |
  |----ACK(ack=y+1)-------->|  ç¬¬ä¸‰æ¬¡æ¡æ‰‹
  |                         |
  |    å»ºç«‹è¿æ¥              |
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ**
- é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨
- ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›æ­£å¸¸

### 1.4 TCPå››æ¬¡æŒ¥æ‰‹ï¼ˆâš ï¸ éš¾ç‚¹ï¼‰

```
å®¢æˆ·ç«¯                    æœåŠ¡å™¨
  |                         |
  |----FIN(seq=u)---------->|  ç¬¬ä¸€æ¬¡æŒ¥æ‰‹
  |                         |
  |<---ACK(ack=u+1)---------|  ç¬¬äºŒæ¬¡æŒ¥æ‰‹
  |                         |
  |<---FIN(seq=w)-----------|  ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹
  |                         |
  |----ACK(ack=w+1)-------->|  ç¬¬å››æ¬¡æŒ¥æ‰‹
  |                         |
  |    è¿æ¥å…³é—­              |
```

**ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ**
- TCPæ˜¯å…¨åŒå·¥é€šä¿¡ï¼Œéœ€è¦åŒæ–¹éƒ½å…³é—­è¿æ¥
- æœåŠ¡å™¨å¯èƒ½è¿˜æœ‰æ•°æ®è¦å‘é€

### 1.5 å¸¸è§ç«¯å£å·

| ç«¯å£ | åè®® | è¯´æ˜ |
|------|------|------|
| 20/21 | FTP | æ–‡ä»¶ä¼ è¾“ |
| 22 | SSH | å®‰å…¨Shell |
| 23 | Telnet | è¿œç¨‹ç™»å½• |
| 25 | SMTP | é‚®ä»¶å‘é€ |
| 53 | DNS | åŸŸåè§£æ |
| 80 | HTTP | ç½‘é¡µæµè§ˆ |
| 443 | HTTPS | å®‰å…¨ç½‘é¡µæµè§ˆ |
| 3306 | MySQL | æ•°æ®åº“ |
| 6379 | Redis | ç¼“å­˜ |
| 8080 | HTTP | å¤‡ç”¨HTTPç«¯å£ |

## ğŸ”¥ TCPç¼–ç¨‹

### 2.1 TCPæœåŠ¡å™¨

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;

/**
 * TCPæœåŠ¡å™¨
 * @author erik.zhou
 */
public class TCPServer {
    public static void main(String[] args) {
        try (ServerSocket serverSocket = new ServerSocket(8080)) {
            System.out.println("æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š8080");
            
            while (true) {
                // é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥
                Socket clientSocket = serverSocket.accept();
                System.out.println("å®¢æˆ·ç«¯è¿æ¥ï¼š" + clientSocket.getInetAddress());
                
                // å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå•çº¿ç¨‹ï¼‰
                handleClient(clientSocket);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    private static void handleClient(Socket socket) {
        try (
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true)
        ) {
            String message = in.readLine();
            System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
            
            // å›å¤å®¢æˆ·ç«¯
            out.println("æœåŠ¡å™¨æ”¶åˆ°ï¼š" + message);
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

### 2.2 TCPå®¢æˆ·ç«¯

```java
import java.io.*;
import java.net.Socket;

/**
 * TCPå®¢æˆ·ç«¯
 * @author erik.zhou
 */
public class TCPClient {
    public static void main(String[] args) {
        try (Socket socket = new Socket("localhost", 8080)) {
            System.out.println("è¿æ¥åˆ°æœåŠ¡å™¨");
            
            // å‘é€æ¶ˆæ¯
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            out.println("Hello Server");
            
            // æ¥æ”¶å“åº”
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            String response = in.readLine();
            System.out.println("æœåŠ¡å™¨å“åº”ï¼š" + response);
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### 2.3 å¤šçº¿ç¨‹TCPæœåŠ¡å™¨ ğŸ”¥

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

/**
 * å¤šçº¿ç¨‹TCPæœåŠ¡å™¨
 * @author erik.zhou
 */
public class MultiThreadTCPServer {
    private static final int PORT = 8080;
    private static final int THREAD_POOL_SIZE = 10;
    
    public static void main(String[] args) {
        ExecutorService executor = Executors.newFixedThreadPool(THREAD_POOL_SIZE);
        
        try (ServerSocket serverSocket = new ServerSocket(PORT)) {
            System.out.println("æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š" + PORT);
            
            while (true) {
                Socket clientSocket = serverSocket.accept();
                System.out.println("å®¢æˆ·ç«¯è¿æ¥ï¼š" + clientSocket.getInetAddress());
                
                // æäº¤åˆ°çº¿ç¨‹æ± å¤„ç†
                executor.submit(new ClientHandler(clientSocket));
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            executor.shutdown();
        }
    }
    
    private static class ClientHandler implements Runnable {
        private final Socket socket;
        
        public ClientHandler(Socket socket) {
            this.socket = socket;
        }
        
        @Override
        public void run() {
            try (
                BufferedReader in = new BufferedReader(
                    new InputStreamReader(socket.getInputStream()));
                PrintWriter out = new PrintWriter(socket.getOutputStream(), true)
            ) {
                String message;
                while ((message = in.readLine()) != null) {
                    System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
                    out.println("æœåŠ¡å™¨æ”¶åˆ°ï¼š" + message);
                    
                    if ("bye".equalsIgnoreCase(message)) {
                        break;
                    }
                }
            } catch (IOException e) {
                e.printStackTrace();
            } finally {
                try {
                    socket.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```

## ğŸ”¥ UDPç¼–ç¨‹

### 3.1 UDPæœåŠ¡å™¨

```java
import java.net.DatagramPacket;
import java.net.DatagramSocket;

/**
 * UDPæœåŠ¡å™¨
 * @author erik.zhou
 */
public class UDPServer {
    private static final int PORT = 9090;
    private static final int BUFFER_SIZE = 1024;
    
    public static void main(String[] args) {
        try (DatagramSocket socket = new DatagramSocket(PORT)) {
            System.out.println("UDPæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š" + PORT);
            
            byte[] buffer = new byte[BUFFER_SIZE];
            
            while (true) {
                // æ¥æ”¶æ•°æ®
                DatagramPacket receivePacket = new DatagramPacket(buffer, buffer.length);
                socket.receive(receivePacket);
                
                String message = new String(receivePacket.getData(), 0, 
                    receivePacket.getLength());
                System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
                
                // å‘é€å“åº”
                String response = "æœåŠ¡å™¨æ”¶åˆ°ï¼š" + message;
                byte[] responseData = response.getBytes();
                DatagramPacket sendPacket = new DatagramPacket(
                    responseData, 
                    responseData.length,
                    receivePacket.getAddress(),
                    receivePacket.getPort()
                );
                socket.send(sendPacket);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 3.2 UDPå®¢æˆ·ç«¯

```java
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

/**
 * UDPå®¢æˆ·ç«¯
 * @author erik.zhou
 */
public class UDPClient {
    private static final String SERVER_HOST = "localhost";
    private static final int SERVER_PORT = 9090;
    private static final int BUFFER_SIZE = 1024;
    
    public static void main(String[] args) {
        try (DatagramSocket socket = new DatagramSocket()) {
            // å‘é€æ•°æ®
            String message = "Hello UDP Server";
            byte[] sendData = message.getBytes();
            InetAddress serverAddress = InetAddress.getByName(SERVER_HOST);
            DatagramPacket sendPacket = new DatagramPacket(
                sendData,
                sendData.length,
                serverAddress,
                SERVER_PORT
            );
            socket.send(sendPacket);
            System.out.println("å‘é€æ¶ˆæ¯ï¼š" + message);
            
            // æ¥æ”¶å“åº”
            byte[] receiveData = new byte[BUFFER_SIZE];
            DatagramPacket receivePacket = new DatagramPacket(
                receiveData,
                receiveData.length
            );
            socket.receive(receivePacket);
            
            String response = new String(receivePacket.getData(), 0, 
                receivePacket.getLength());
            System.out.println("æœåŠ¡å™¨å“åº”ï¼š" + response);
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## ğŸ”¥ HTTPç¼–ç¨‹

### 4.1 HTTPå®¢æˆ·ç«¯ï¼ˆHttpURLConnectionï¼‰

```java
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

/**
 * HTTPå®¢æˆ·ç«¯
 * @author erik.zhou
 */
public class HTTPClient {
    public static void main(String[] args) {
        try {
            // GETè¯·æ±‚
            String response = sendGet("https://api.github.com/users/github");
            System.out.println("å“åº”ï¼š" + response);
            
            // POSTè¯·æ±‚
            String postResponse = sendPost("https://httpbin.org/post", 
                "{\"name\":\"test\"}");
            System.out.println("POSTå“åº”ï¼š" + postResponse);
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    private static String sendGet(String urlString) throws Exception {
        URL url = new URL(urlString);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        
        // è®¾ç½®è¯·æ±‚æ–¹æ³•
        conn.setRequestMethod("GET");
        conn.setRequestProperty("User-Agent", "Mozilla/5.0");
        conn.setConnectTimeout(5000);
        conn.setReadTimeout(5000);
        
        // è¯»å–å“åº”
        int responseCode = conn.getResponseCode();
        System.out.println("å“åº”ç ï¼š" + responseCode);
        
        BufferedReader in = new BufferedReader(
            new InputStreamReader(conn.getInputStream()));
        String inputLine;
        StringBuilder response = new StringBuilder();
        
        while ((inputLine = in.readLine()) != null) {
            response.append(inputLine);
        }
        in.close();
        
        return response.toString();
    }
    
    private static String sendPost(String urlString, String jsonData) throws Exception {
        URL url = new URL(urlString);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        
        // è®¾ç½®è¯·æ±‚æ–¹æ³•
        conn.setRequestMethod("POST");
        conn.setRequestProperty("Content-Type", "application/json");
        conn.setDoOutput(true);
        
        // å‘é€è¯·æ±‚ä½“
        conn.getOutputStream().write(jsonData.getBytes());
        
        // è¯»å–å“åº”
        BufferedReader in = new BufferedReader(
            new InputStreamReader(conn.getInputStream()));
        String inputLine;
        StringBuilder response = new StringBuilder();
        
        while ((inputLine = in.readLine()) != null) {
            response.append(inputLine);
        }
        in.close();
        
        return response.toString();
    }
}
```

## ğŸ”¥ NIOç¼–ç¨‹ï¼ˆâš ï¸ éš¾ç‚¹ï¼‰

### 5.1 NIOæ ¸å¿ƒæ¦‚å¿µ

**ä¸‰å¤§æ ¸å¿ƒç»„ä»¶**:
1. **Channelï¼ˆé€šé“ï¼‰**: åŒå‘æ•°æ®ä¼ è¾“é€šé“
2. **Bufferï¼ˆç¼“å†²åŒºï¼‰**: æ•°æ®å®¹å™¨
3. **Selectorï¼ˆé€‰æ‹©å™¨ï¼‰**: å¤šè·¯å¤ç”¨å™¨

### 5.2 NIOæœåŠ¡å™¨

```java
import java.io.IOException;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.*;
import java.util.Iterator;

/**
 * NIOæœåŠ¡å™¨
 * @author erik.zhou
 */
public class NIOServer {
    private static final int PORT = 8080;
    private static final int BUFFER_SIZE = 1024;
    
    public static void main(String[] args) {
        try {
            // åˆ›å»ºé€‰æ‹©å™¨
            Selector selector = Selector.open();
            
            // åˆ›å»ºæœåŠ¡å™¨é€šé“
            ServerSocketChannel serverChannel = ServerSocketChannel.open();
            serverChannel.bind(new InetSocketAddress(PORT));
            serverChannel.configureBlocking(false);
            
            // æ³¨å†Œåˆ°é€‰æ‹©å™¨
            serverChannel.register(selector, SelectionKey.OP_ACCEPT);
            System.out.println("NIOæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š" + PORT);
            
            while (true) {
                // é˜»å¡ç­‰å¾…äº‹ä»¶
                selector.select();
                
                // å¤„ç†äº‹ä»¶
                Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();
                while (iterator.hasNext()) {
                    SelectionKey key = iterator.next();
                    iterator.remove();
                    
                    if (key.isAcceptable()) {
                        handleAccept(key, selector);
                    } else if (key.isReadable()) {
                        handleRead(key);
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    private static void handleAccept(SelectionKey key, Selector selector) 
            throws IOException {
        ServerSocketChannel serverChannel = (ServerSocketChannel) key.channel();
        SocketChannel clientChannel = serverChannel.accept();
        clientChannel.configureBlocking(false);
        clientChannel.register(selector, SelectionKey.OP_READ);
        System.out.println("å®¢æˆ·ç«¯è¿æ¥ï¼š" + clientChannel.getRemoteAddress());
    }
    
    private static void handleRead(SelectionKey key) throws IOException {
        SocketChannel channel = (SocketChannel) key.channel();
        ByteBuffer buffer = ByteBuffer.allocate(BUFFER_SIZE);
        
        int bytesRead = channel.read(buffer);
        if (bytesRead == -1) {
            channel.close();
            return;
        }
        
        buffer.flip();
        byte[] data = new byte[buffer.remaining()];
        buffer.get(data);
        String message = new String(data);
        System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
        
        // å›å¤å®¢æˆ·ç«¯
        String response = "æœåŠ¡å™¨æ”¶åˆ°ï¼š" + message;
        ByteBuffer responseBuffer = ByteBuffer.wrap(response.getBytes());
        channel.write(responseBuffer);
    }
}
```

## ğŸ’» å®æˆ˜åº”ç”¨

### 6.1 ç®€å•èŠå¤©å®¤

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.CopyOnWriteArrayList;

/**
 * ç®€å•èŠå¤©å®¤æœåŠ¡å™¨
 * @author erik.zhou
 */
public class ChatServer {
    private static final int PORT = 8888;
    private static final CopyOnWriteArrayList<ClientHandler> clients = 
        new CopyOnWriteArrayList<>();
    
    public static void main(String[] args) {
        try (ServerSocket serverSocket = new ServerSocket(PORT)) {
            System.out.println("èŠå¤©å®¤æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š" + PORT);
            
            while (true) {
                Socket clientSocket = serverSocket.accept();
                ClientHandler handler = new ClientHandler(clientSocket);
                clients.add(handler);
                new Thread(handler).start();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    private static class ClientHandler implements Runnable {
        private final Socket socket;
        private PrintWriter out;
        private String username;
        
        public ClientHandler(Socket socket) {
            this.socket = socket;
        }
        
        @Override
        public void run() {
            try (
                BufferedReader in = new BufferedReader(
                    new InputStreamReader(socket.getInputStream()))
            ) {
                out = new PrintWriter(socket.getOutputStream(), true);
                
                // è·å–ç”¨æˆ·å
                out.println("è¯·è¾“å…¥ç”¨æˆ·åï¼š");
                username = in.readLine();
                broadcast(username + " åŠ å…¥èŠå¤©å®¤");
                
                // å¤„ç†æ¶ˆæ¯
                String message;
                while ((message = in.readLine()) != null) {
                    if ("bye".equalsIgnoreCase(message)) {
                        break;
                    }
                    broadcast(username + ": " + message);
                }
            } catch (IOException e) {
                e.printStackTrace();
            } finally {
                clients.remove(this);
                broadcast(username + " ç¦»å¼€èŠå¤©å®¤");
                try {
                    socket.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
        
        private void broadcast(String message) {
            System.out.println(message);
            for (ClientHandler client : clients) {
                client.out.println(message);
            }
        }
    }
}
```

### 6.2 ç²˜åŒ…é—®é¢˜å¤„ç†ï¼ˆâš ï¸ éš¾ç‚¹ï¼‰

```java
import java.io.*;
import java.net.Socket;
import java.nio.ByteBuffer;

/**
 * ç²˜åŒ…é—®é¢˜å¤„ç†
 * @author erik.zhou
 */
public class PacketHandler {
    // æ–¹æ¡ˆ1ï¼šå›ºå®šé•¿åº¦
    public static void sendFixedLength(Socket socket, String message) 
            throws IOException {
        byte[] data = message.getBytes();
        byte[] packet = new byte[1024]; // å›ºå®š1024å­—èŠ‚
        System.arraycopy(data, 0, packet, 0, Math.min(data.length, 1024));
        socket.getOutputStream().write(packet);
    }
    
    // æ–¹æ¡ˆ2ï¼šåˆ†éš”ç¬¦
    public static void sendWithDelimiter(Socket socket, String message) 
            throws IOException {
        String packet = message + "\n"; // ä½¿ç”¨æ¢è¡Œç¬¦åˆ†éš”
        socket.getOutputStream().write(packet.getBytes());
    }
    
    // æ–¹æ¡ˆ3ï¼šæ¶ˆæ¯å¤´ï¼ˆé•¿åº¦+å†…å®¹ï¼‰
    public static void sendWithHeader(Socket socket, String message) 
            throws IOException {
        byte[] data = message.getBytes();
        ByteBuffer buffer = ByteBuffer.allocate(4 + data.length);
        buffer.putInt(data.length); // 4å­—èŠ‚é•¿åº¦
        buffer.put(data);           // æ¶ˆæ¯å†…å®¹
        socket.getOutputStream().write(buffer.array());
    }
    
    public static String receiveWithHeader(Socket socket) throws IOException {
        InputStream in = socket.getInputStream();
        
        // è¯»å–é•¿åº¦
        byte[] lengthBytes = new byte[4];
        in.read(lengthBytes);
        int length = ByteBuffer.wrap(lengthBytes).getInt();
        
        // è¯»å–å†…å®¹
        byte[] data = new byte[length];
        int totalRead = 0;
        while (totalRead < length) {
            int read = in.read(data, totalRead, length - totalRead);
            if (read == -1) {
                break;
            }
            totalRead += read;
        }
        
        return new String(data);
    }
}
```

## âœ¨ æœ€ä½³å®è·µ

### 1. èµ„æºç®¡ç†

```java
// é”™è¯¯ï¼šæœªå…³é—­èµ„æº
Socket socket = new Socket("localhost", 8080);
// ä½¿ç”¨socket...

// æ­£ç¡®ï¼šä½¿ç”¨try-with-resources
try (Socket socket = new Socket("localhost", 8080)) {
    // ä½¿ç”¨socket...
}
```

### 2. è¶…æ—¶è®¾ç½®

```java
Socket socket = new Socket();
socket.connect(new InetSocketAddress("localhost", 8080), 5000); // è¿æ¥è¶…æ—¶
socket.setSoTimeout(3000); // è¯»å–è¶…æ—¶
```

### 3. çº¿ç¨‹æ± ä½¿ç”¨

```java
// é”™è¯¯ï¼šæ¯ä¸ªè¿æ¥åˆ›å»ºæ–°çº¿ç¨‹
while (true) {
    Socket socket = serverSocket.accept();
    new Thread(() -> handleClient(socket)).start();
}

// æ­£ç¡®ï¼šä½¿ç”¨çº¿ç¨‹æ± 
ExecutorService executor = Executors.newFixedThreadPool(10);
while (true) {
    Socket socket = serverSocket.accept();
    executor.submit(() -> handleClient(socket));
}
```

## â“ å¸¸è§é—®é¢˜

### Q1: TCPå’ŒUDPå¦‚ä½•é€‰æ‹©ï¼Ÿ
A: éœ€è¦å¯é ä¼ è¾“ç”¨TCPï¼ˆæ–‡ä»¶ä¼ è¾“ã€HTTPï¼‰ï¼Œè¿½æ±‚é€Ÿåº¦ç”¨UDPï¼ˆè§†é¢‘ç›´æ’­ã€æ¸¸æˆï¼‰ã€‚

### Q2: å¦‚ä½•è§£å†³ç²˜åŒ…é—®é¢˜ï¼Ÿ
A: ä½¿ç”¨å›ºå®šé•¿åº¦ã€åˆ†éš”ç¬¦æˆ–æ¶ˆæ¯å¤´ï¼ˆé•¿åº¦+å†…å®¹ï¼‰ã€‚

### Q3: ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ
A: ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›æ­£å¸¸ï¼Œé˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ã€‚

### Q4: NIOå’ŒBIOçš„åŒºåˆ«ï¼Ÿ
A: BIOæ˜¯é˜»å¡IOï¼Œä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥ï¼›NIOæ˜¯éé˜»å¡IOï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥ã€‚

### Q5: å¦‚ä½•æé«˜ç½‘ç»œç¼–ç¨‹æ€§èƒ½ï¼Ÿ
A: ä½¿ç”¨NIOã€çº¿ç¨‹æ± ã€è¿æ¥æ± ã€å‡å°‘æ•°æ®æ‹·è´ã€ä½¿ç”¨ç¼“å†²åŒºã€‚

## ğŸ”— ç›¸å…³èµ„æº

- [ã€ŠJavaç½‘ç»œç¼–ç¨‹ã€‹](https://book.douban.com/subject/1438754/)
- [ã€ŠNettyæƒå¨æŒ‡å—ã€‹](https://book.douban.com/subject/25897245/)
- [Oracleç½‘ç»œç¼–ç¨‹æ•™ç¨‹](https://docs.oracle.com/javase/tutorial/networking/)

## ğŸ“ å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£TCP/IPåè®®æ ˆ
- [ ] æŒæ¡TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹
- [ ] ç†Ÿç»ƒä½¿ç”¨Socketç¼–ç¨‹
- [ ] ç†è§£UDPç¼–ç¨‹
- [ ] æŒæ¡HTTPç¼–ç¨‹
- [ ] ç†è§£NIOå’Œå¤šè·¯å¤ç”¨
- [ ] èƒ½å¤Ÿå¤„ç†ç²˜åŒ…é—®é¢˜
- [ ] èƒ½å¤Ÿä½¿ç”¨çº¿ç¨‹æ± ä¼˜åŒ–æ€§èƒ½

---

**å­¦ä¹ å»ºè®®**ï¼š
1. å…ˆç†è§£ç½‘ç»œåè®®ï¼Œå†å­¦ä¹ ç¼–ç¨‹
2. å¤šå†™ä»£ç å®è·µï¼Œç†è§£é˜»å¡å’Œéé˜»å¡
3. å­¦ä¹ Nettyæ¡†æ¶ï¼Œç†è§£é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹
4. å…³æ³¨ç½‘ç»œå®‰å…¨é—®é¢˜
5. åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨æ‰€å­¦çŸ¥è¯†
